{% comment %} 
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ğŸ”¥ STICKY BAR VIP - 100% CONFIGURABLE
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
{% endcomment %}

{% if section.settings.enabled %}
<style>
  .sticky-bar-promo {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background: linear-gradient(135deg, {{ section.settings.bg_color_start }} 0%, {{ section.settings.bg_color_end }} 100%);
    z-index: 9999;
    padding: {{ section.settings.padding_vertical }}px {{ section.settings.padding_horizontal }}px;
    box-shadow: 0 -4px 20px rgba(0,0,0,0.3);
    display: block;
  }
  
  .sticky-bar-promo__container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
    max-width: 600px;
    margin: 0 auto;
  }
  
  .sticky-bar-promo__left {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
  }
  
  .sticky-bar-promo__badge {
    background: {{ section.settings.badge_bg }};
    color: {{ section.settings.badge_text_color }};
    padding: 3px 8px;
    border-radius: 10px;
    font-size: {{ section.settings.badge_font_size }}px;
    font-weight: 700;
  }
  
  .sticky-bar-promo__offer {
    color: {{ section.settings.offer_text_color }};
    font-size: {{ section.settings.offer_font_size }}px;
    font-weight: 600;
  }
  
  .sticky-bar-promo__price {
    color: {{ section.settings.price_color }};
    font-size: {{ section.settings.price_font_size }}px;
    font-weight: 800;
  }
  
  .sticky-bar-promo__discount {
    color: {{ section.settings.discount_color }};
    font-size: {{ section.settings.discount_font_size }}px;
  }
  
  .sticky-bar-promo__discount s {
    margin-right: 4px;
  }
  
  .sticky-bar-promo__cta {
    background: linear-gradient(135deg, {{ section.settings.cta_bg_start }}, {{ section.settings.cta_bg_end }});
    color: {{ section.settings.cta_text_color }};
    border: none;
    padding: {{ section.settings.cta_padding_vertical }}px {{ section.settings.cta_padding_horizontal }}px;
    border-radius: {{ section.settings.cta_border_radius }}px;
    font-size: {{ section.settings.cta_font_size }}px;
    font-weight: 800;
    text-transform: uppercase;
    cursor: pointer;
    text-decoration: none;
    white-space: nowrap;
    transition: all 0.3s;
  }
  
  .sticky-bar-promo__cta:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
  }
  
  .sticky-bar-promo__cta.loading {
    opacity: 0.7;
    pointer-events: none;
  }
  
  body {
    padding-bottom: 70px;
  }
  
  {% if section.settings.hide_on_desktop %}
  @media (min-width: 769px) {
    .sticky-bar-promo {
      display: none !important;
    }
    body {
      padding-bottom: 0;
    }
  }
  {% endif %}
  
  {% if section.settings.hide_on_mobile %}
  @media (max-width: 768px) {
    .sticky-bar-promo {
      display: none !important;
    }
    body {
      padding-bottom: 0;
    }
  }
  {% endif %}
</style>

<div class="sticky-bar-promo" id="stickyBarPromo">
  <div class="sticky-bar-promo__container">
    <div class="sticky-bar-promo__left">
      {% if section.settings.badge_text != blank %}
        <span class="sticky-bar-promo__badge">{{ section.settings.badge_text }}</span>
      {% endif %}
      
      {% if section.settings.offer_text != blank %}
        <span class="sticky-bar-promo__offer">{{ section.settings.offer_text }}</span>
      {% endif %}
      
      {% if section.settings.price != blank %}
        <span class="sticky-bar-promo__price">{{ section.settings.price }}</span>
      {% endif %}
      
      {% if section.settings.price_old != blank or section.settings.discount_text != blank %}
        <span class="sticky-bar-promo__discount">
          {% if section.settings.price_old != blank %}<s>{{ section.settings.price_old }}</s>{% endif %}
          {{ section.settings.discount_text }}
        </span>
      {% endif %}
    </div>
    
    <button class="sticky-bar-promo__cta" id="stickyBarPromoCta">
      {{ section.settings.cta_text }}
    </button>
  </div>
</div>

<script>
(function() {
  const VARIANT_ID = {{ section.settings.variant_id | default: 0 }};
  const QUANTITY = {{ section.settings.quantity | default: 5 }};
  const PRODUCT_PAGE_ONLY = {{ section.settings.product_page_only }};
  
  if (PRODUCT_PAGE_ONLY && !window.location.pathname.includes('/products/')) {
    const stickyBar = document.getElementById('stickyBarPromo');
    if (stickyBar) stickyBar.style.display = 'none';
    document.body.style.paddingBottom = '0';
    return;
  }
  
  const ctaBtn = document.getElementById('stickyBarPromoCta');
  
  if (!ctaBtn) return;
  
  ctaBtn.addEventListener('click', function() {
    if (!VARIANT_ID || VARIANT_ID === 0) {
      alert('Erreur: Variant ID non configurÃ©');
      return;
    }
    
    ctaBtn.disabled = true;
    ctaBtn.textContent = 'AJOUT...';
    
    fetch('/cart/add.js', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        id: VARIANT_ID,
        quantity: QUANTITY
      })
    })
    .then(function(response) {
      return response.json();
    })
    .then(function(data) {
      ctaBtn.textContent = 'âœ“ AJOUTÃ‰ !';
      
      // Ouvrir le cart drawer
      const cartDrawer = document.querySelector('cart-drawer');
      if (cartDrawer && typeof cartDrawer.open === 'function') {
        cartDrawer.open();
      } else {
        // MÃ©thode alternative 1 : cliquer sur l'icÃ´ne panier
        const cartIcon = document.querySelector('[data-cart-drawer-toggle]') 
          || document.querySelector('.header__icon--cart')
          || document.querySelector('[href="/cart"]')
          || document.querySelector('.cart-icon');
        if (cartIcon) cartIcon.click();
        
        // MÃ©thode alternative 2 : dÃ©clencher l'Ã©vÃ©nement
        document.dispatchEvent(new CustomEvent('cart:open'));
        document.dispatchEvent(new CustomEvent('theme:cart:open'));
      }
      
      setTimeout(function() {
        ctaBtn.disabled = false;
        ctaBtn.textContent = 'J\'EN PROFITE';
      }, 2000);
    })
    .catch(function(error) {
      console.error('Erreur:', error);
      ctaBtn.disabled = false;
      ctaBtn.textContent = 'J\'EN PROFITE';
      alert('Erreur, veuillez rÃ©essayer');
    });
  });
})();
</script>
{% endif %}

{% schema %}
{
  "name": "ğŸ”¥ Sticky Bar VIP",
  "settings": [
    {
      "type": "header",
      "content": "â•â•â• ACTIVATION â•â•â•"
    },
    {
      "type": "checkbox",
      "id": "enabled",
      "label": "Activer la sticky bar",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "product_page_only",
      "label": "Afficher uniquement sur pages produit",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "hide_on_desktop",
      "label": "Masquer sur desktop",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "hide_on_mobile",
      "label": "Masquer sur mobile",
      "default": false
    },
    {
      "type": "header",
      "content": "â•â•â• PRODUIT / PANIER â•â•â•"
    },
    {
      "type": "text",
      "id": "variant_id",
      "label": "Variant ID du produit",
      "info": "Trouve-le dans Produits > Variantes > URL"
    },
    {
      "type": "range",
      "id": "quantity",
      "min": 1,
      "max": 10,
      "step": 1,
      "label": "QuantitÃ© Ã  ajouter",
      "default": 5,
      "info": "5 = Pack 3+2 offerts"
    },
    {
      "type": "checkbox",
      "id": "redirect_to_cart",
      "label": "Rediriger vers le panier aprÃ¨s ajout",
      "default": true
    },
    {
      "type": "header",
      "content": "â•â•â• TEXTES â•â•â•"
    },
    {
      "type": "text",
      "id": "badge_text",
      "label": "Badge",
      "default": "ğŸ”¥ PACK VIP"
    },
    {
      "type": "text",
      "id": "offer_text",
      "label": "Texte offre",
      "default": "3 = 2 OFFERTS"
    },
    {
      "type": "text",
      "id": "price",
      "label": "Prix",
      "default": "104,97â‚¬"
    },
    {
      "type": "text",
      "id": "price_old",
      "label": "Ancien prix (barrÃ©)",
      "default": "174,97â‚¬"
    },
    {
      "type": "text",
      "id": "discount_text",
      "label": "Texte rÃ©duction",
      "default": "-40%"
    },
    {
      "type": "header",
      "content": "â•â•â• BOUTON â•â•â•"
    },
    {
      "type": "text",
      "id": "cta_text",
      "label": "Texte bouton",
      "default": "J'EN PROFITE"
    },
    {
      "type": "text",
      "id": "cta_text_loading",
      "label": "Texte pendant chargement",
      "default": "AJOUT..."
    },
    {
      "type": "text",
      "id": "cta_text_success",
      "label": "Texte aprÃ¨s succÃ¨s",
      "default": "âœ“ AJOUTÃ‰ !"
    },
    {
      "type": "header",
      "content": "â•â•â• COULEURS FOND â•â•â•"
    },
    {
      "type": "color",
      "id": "bg_color_start",
      "label": "Fond - DÃ©but dÃ©gradÃ©",
      "default": "#8B4F9D"
    },
    {
      "type": "color",
      "id": "bg_color_end",
      "label": "Fond - Fin dÃ©gradÃ©",
      "default": "#5D3A6E"
    },
    {
      "type": "header",
      "content": "â•â•â• COULEURS TEXTES â•â•â•"
    },
    {
      "type": "color",
      "id": "badge_bg",
      "label": "Badge - Fond",
      "default": "#ff6b6b"
    },
    {
      "type": "color",
      "id": "badge_text_color",
      "label": "Badge - Texte",
      "default": "#FFFFFF"
    },
    {
      "type": "color",
      "id": "offer_text_color",
      "label": "Offre - Texte",
      "default": "#FFFFFF"
    },
    {
      "type": "color",
      "id": "price_color",
      "label": "Prix - Couleur",
      "default": "#FFD700"
    },
    {
      "type": "color",
      "id": "discount_color",
      "label": "RÃ©duction - Couleur",
      "default": "#CCCCCC"
    },
    {
      "type": "header",
      "content": "â•â•â• COULEURS BOUTON â•â•â•"
    },
    {
      "type": "color",
      "id": "cta_bg_start",
      "label": "Bouton - DÃ©but dÃ©gradÃ©",
      "default": "#FFD700"
    },
    {
      "type": "color",
      "id": "cta_bg_end",
      "label": "Bouton - Fin dÃ©gradÃ©",
      "default": "#FFA500"
    },
    {
      "type": "color",
      "id": "cta_text_color",
      "label": "Bouton - Texte",
      "default": "#1a1a1a"
    },
    {
      "type": "header",
      "content": "â•â•â• TAILLES TEXTES â•â•â•"
    },
    {
      "type": "range",
      "id": "badge_font_size",
      "min": 8,
      "max": 16,
      "step": 1,
      "unit": "px",
      "label": "Badge - Taille",
      "default": 10
    },
    {
      "type": "range",
      "id": "offer_font_size",
      "min": 8,
      "max": 16,
      "step": 1,
      "unit": "px",
      "label": "Offre - Taille",
      "default": 11
    },
    {
      "type": "range",
      "id": "price_font_size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Prix - Taille",
      "default": 16
    },
    {
      "type": "range",
      "id": "discount_font_size",
      "min": 8,
      "max": 16,
      "step": 1,
      "unit": "px",
      "label": "RÃ©duction - Taille",
      "default": 11
    },
    {
      "type": "range",
      "id": "cta_font_size",
      "min": 10,
      "max": 18,
      "step": 1,
      "unit": "px",
      "label": "Bouton - Taille texte",
      "default": 12
    },
    {
      "type": "header",
      "content": "â•â•â• ESPACEMENTS â•â•â•"
    },
    {
      "type": "range",
      "id": "padding_vertical",
      "min": 5,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Padding vertical",
      "default": 10
    },
    {
      "type": "range",
      "id": "padding_horizontal",
      "min": 10,
      "max": 30,
      "step": 1,
      "unit": "px",
      "label": "Padding horizontal",
      "default": 15
    },
    {
      "type": "range",
      "id": "cta_padding_vertical",
      "min": 5,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Bouton - Padding vertical",
      "default": 10
    },
    {
      "type": "range",
      "id": "cta_padding_horizontal",
      "min": 10,
      "max": 30,
      "step": 1,
      "unit": "px",
      "label": "Bouton - Padding horizontal",
      "default": 16
    },
    {
      "type": "range",
      "id": "cta_border_radius",
      "min": 0,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Bouton - Arrondi",
      "default": 6
    }
  ],
  "presets": [
    {
      "name": "ğŸ”¥ Sticky Bar VIP"
    }
  ]
}
{% endschema %}