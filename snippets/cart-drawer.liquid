{% comment %}
  Renders cart drawer

  Usage:
  {% render 'cart-drawer' %}
{% endcomment %}

{%- render 'script' with 'cart', defer: true -%}

<style>
  .drawer {
    visibility: hidden;
  }

  /* ============================================
     STYLES PANIER VIDE - CENTRÃ‰ ET UNIFORME
     ============================================ */
  .drawer__inner-empty {
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    padding: 40px 20px;
    background: var(--color-background, #ffffff);
  }

  .cart-drawer__warnings {
    text-align: center;
    width: 100%;
    max-width: 400px;
    margin: 0 auto;
  }

  .cart-drawer__empty-content {
    position: relative;
    padding: 60px 30px;
  }

  /* IcÃ´ne panier vide */
  .cart-drawer__empty-content::before {
    content: 'ðŸ›’';
    font-size: 80px;
    display: block;
    margin-bottom: 24px;
    opacity: 0.3;
    animation: float 3s ease-in-out infinite;
  }

  @keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
  }

  /* Titre "Votre panier est vide" */
  .cart__empty-text {
    font-size: 24px;
    font-weight: 600;
    color: var(--color-foreground, #333);
    margin: 0 0 16px 0;
    line-height: 1.3;
  }

  /* Texte descriptif */
  .cart-drawer__empty-content::after {
    content: 'DÃ©couvrez nos produits et commencez vos achats !';
    display: block;
    font-size: 16px;
    color: #666;
    margin-bottom: 32px;
    line-height: 1.5;
  }

  /* Bouton "Continuer vos achats" */
  .cart-drawer__empty-content .button {
    display: inline-block;
    padding: 16px 40px;
    font-size: 16px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    transition: all 0.3s ease;
    margin-top: 8px;
  }

  .cart-drawer__empty-content .button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
  }

  /* Bouton de fermeture */
  .cart-drawer__empty-content .drawer__close {
    position: absolute;
    top: 20px;
    right: 20px;
    background: transparent;
    border: none;
    font-size: 32px;
    color: var(--color-foreground, #333);
    cursor: pointer;
    padding: 8px;
    line-height: 1;
    opacity: 0.6;
    transition: all 0.2s;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .cart-drawer__empty-content .drawer__close:hover {
    opacity: 1;
    transform: rotate(90deg);
  }

  /* MASQUER TOUS LES MODULES QUAND LE PANIER EST VIDE */
  cart-drawer.is-empty .drawer__header,
  cart-drawer.is-empty .drawer__module,
  cart-drawer.is-empty .cart-drawer-items,
  cart-drawer.is-empty .drawer__upsell,
  cart-drawer.is-empty .drawer__footer {
    display: none !important;
  }

  /* Assurer que seul le contenu vide est visible */
  cart-drawer.is-empty .drawer__inner {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* Responsive mobile */
  @media (max-width: 768px) {
    .cart-drawer__empty-content {
      padding: 40px 20px;
    }

    .cart-drawer__empty-content::before {
      font-size: 60px;
      margin-bottom: 20px;
    }

    .cart__empty-text {
      font-size: 20px;
      margin-bottom: 12px;
    }

    .cart-drawer__empty-content::after {
      font-size: 14px;
      margin-bottom: 24px;
    }

    .cart-drawer__empty-content .button {
      padding: 14px 32px;
      font-size: 15px;
      width: 100%;
    }
  }
</style>

{% liquid
  assign protection_active = false
  assign protection_index = 0
  for item in cart.items
    if item.product_id == section.settings.cart_protection_product.id
      assign protection_active = true
      assign protection_index = forloop.index
    endif
  endfor
%}

<cart-drawer class="drawer {% if cart == empty %} is-empty{% endif %} {{ protection_active }}">
  <div id="CartDrawer" class="cart-drawer">
    <div id="CartDrawer-Overlay" class="cart-drawer__overlay"></div>
    <div
      class="drawer__inner color-{{ section.settings.cart_general_color_palette }}"
      role="dialog"
      aria-modal="true"
      aria-label="{{ 'sections.cart.title' | t }}"
      tabindex="-1"
    >
      {%- if cart == empty -%}
        <div class="drawer__inner-empty">
          <div class="cart-drawer__warnings center{% if section.settings.cart_drawer_collection != blank %} cart-drawer__warnings--has-collection{% endif %}">
            <div class="cart-drawer__empty-content">
              <h2 class="cart__empty-text">{{ 'sections.cart.empty' | t }}</h2>
              <button
                class="drawer__close"
                type="button"
                onclick="this.closest('cart-drawer').close()"
                aria-label="{{ 'accessibility.close' | t }}"
              >
                {% render 'icon-close' %}
              </button>
              <a href="{{ section.settings.cart_empty_url | default: routes.all_products_collection_url }}" class="button button__style--1">
                {{ 'general.continue_shopping' | t }}
              </a>
            </div>
          </div>
        </div>
      {%- endif -%}
      <div class="drawer__header">
        <h2 class="drawer__heading">{{ 'sections.cart.title' | t }}</h2>
        <button
          class="drawer__close"
          type="button"
          onclick="this.closest('cart-drawer').close()"
          aria-label="{{ 'accessibility.close' | t }}"
        >
          {% render 'icon-close' %}
        </button>
      </div>

      {%- for block in section.blocks -%}
        {%- case block.type -%}
          {%- when 'timer' -%}
            <div
              class="drawer__module text-{{ section.settings.cart_modules_alignment }} color-{{ block.settings.color_palette }} drawer__module--timer"
              data-duration="{{ block.settings.delay }}"
              {{ block.shopify_attributes }}
            >
              {%- assign timer = "<span class='drawer__module--timer-time'></span>" -%}
              <p class="timer__text">
                {{- block.settings.text | replace: '$time', timer -}}
              </p>
            </div>
          {%- when 'free_shipping' -%}
            <div
              class="drawer__module text-{{ section.settings.cart_modules_alignment }} color-{{ block.settings.color_palette }} drawer__module--free_shipping"
              data-target="{{ block.settings.min_price }}"
              {{ block.shopify_attributes }}
            >
              <div class="free-shipping__bar">
                <div class="free-shipping__drag"></div>
              </div>
              {%- assign left_amount = "<span class='free-shipping__amount'></span>" -%}
              <p class="free-shipping__left-amount">
                {{- block.settings.text_before | replace: '$amount', left_amount -}}
              </p>
              <p class="free-shipping__success hidden">{{- block.settings.text_after -}}</p>
            </div>
          {%- when 'trust' -%}
            <style>
              .drawer__module .drawer-trust__slide img,
              .drawer__module .drawer-trust__slide svg {
                width: {{ block.settings.size }}px;
                height: {{ block.settings.size }}px;
              }
            </style>
            <div class="drawer__module text-{{ section.settings.cart_modules_alignment }} color-{{ block.settings.color_palette }} drawer__module--trust" {{ block.shopify_attributes }}>
              <div
                {%- if block.settings.style == 'slider' %}
                  id="drawer-trust__swiper"
                {% endif %}
                class="{% if block.settings.style == 'slider' %}swiper swiper_no_pagination {% else %}bullets bullets__alignement--{{ section.settings.cart_modules_alignment }} {% endif %}drawer-trust__swiper">
                {%- render 'cart-drawer-icons' -%}
                {%- if block.settings.style == 'slider' %}
                  <div class="swiper-button-prev button-prev-drawer-trust__swiper"></div>
                  <div class="swiper-button-next button-next-drawer-trust__swiper"></div>
                {%- endif -%}
              </div>
            </div>
          {%- when 'delivery_estimation' -%}
            <div class="drawer__module text-{{ section.settings.cart_modules_alignment }} color-{{ block.settings.color_palette }} drawer__module--delivery-estimation" {{ block.shopify_attributes }}>
              {{ 'delivery-estimation.css' | asset_url | stylesheet_tag }}
              <delivery-estimation
                data-ready="{{ block.settings.ready }}"
                data-delivered="{{ block.settings.delivered }}"
                data-format="{{ block.settings.format }}"
                class="delivery__wrapper delivery__wrapper-icon-color--{{ block.settings.icons_color }}"
              >
                <div class="delivery__step">
                  <div class="delivery__icon">
                    {% if block.settings.today_image != blank %}
                      {{ block.settings.today_image | image_url: width: 56 | image_tag: class: 'delivery__custom-icon' }}
                    {% else %}
                      {%- render 'icon-cart' -%}
                    {% endif %}
                  </div>

                  <div class="delivery__meta">
                    <p class="delivery__date today">...</p>
                    <p class="delivery__info">{{ block.settings.today_info }}</p>
                  </div>
                </div>

                <div class="delivery__step">
                  <div class="delivery__icon">
                    {% if block.settings.ready_image != blank %}
                      {{ block.settings.ready_image | image_url: width: 56 | image_tag: class: 'delivery__custom-icon' }}
                    {% else %}
                      {%- render 'icons', icon: 'truck' -%}
                    {% endif %}
                  </div>

                  <div class="delivery__meta">
                    <p class="delivery__date ready">...</p>
                    <p class="delivery__info">{{ block.settings.ready_info }}</p>
                  </div>
                </div>

                <div class="delivery__step">
                  <div class="delivery__icon">
                    {% if block.settings.delivered_image != blank %}
                      {{ block.settings.delivered_image | image_url: width: 56 | image_tag: class: 'delivery__custom-icon' }}
                    {% else %}
                      {%- render 'icons', icon: 'box' -%}
                    {% endif %}
                  </div>

                  <div class="delivery__meta">
                    <p class="delivery__date delivered">...</p>
                    <p class="delivery__info">{{ block.settings.delivered_info }}</p>
                  </div>
                </div>
              </delivery-estimation>
            </div>
        {%- endcase -%}
      {%- endfor -%}

      <div class="cart-drawer-items">
        <cart-drawer-items
          {% if cart == empty %}
            class=" is-empty"
          {% endif %}
        >
          <form
            action="{{ routes.cart_url }}"
            id="CartDrawer-Form"
            class="cart__contents cart-drawer__form"
            method="post"
          >
            <div id="CartDrawer-CartItems" class="drawer__contents js-contents">
              {%- if cart != empty -%}
                <div class="drawer__cart-items-wrapper">
                  <table class="cart-items" role="table">
                    <tbody role="rowgroup">
                      {%- for item in cart.items -%}
                        <tr
                          id="CartDrawer-Item-{{ item.index | plus: 1 }}"
                          class="cart-item{% if item.product_id == section.settings.cart_protection_product.id %} cart-item--hidden{% endif %}"
                          role="row"
                        >
                          <td class="cart-item__media" role="cell" headers="CartDrawer-ColumnProductImage">
                            {% if item.image %}
                              {% comment %} Leave empty space due to a:empty CSS display: none rule {% endcomment %}
                              <a href="{{ item.url }}" class="cart-item__link" tabindex="-1" aria-hidden="true"> </a>
                              <img
                                class="cart-item__image"
                                src="{{ item.image | image_url: width: 300 }}"
                                alt="{{ item.image.alt | escape }}"
                                loading="lazy"
                                width="150"
                                height="{{ 150 | divided_by: item.image.aspect_ratio | ceil }}"
                              >
                            {% endif %}
                          </td>

                          <td class="cart-item__details" role="cell" headers="CartDrawer-ColumnProduct">
                            {%- if section.settings.show_vendor -%}
                              <p class="caption-with-letter-spacing light">{{ item.product.vendor }}</p>
                            {%- endif -%}

                            <a href="{{ item.url }}" class="cart-item__name h4 break">
                              {{- item.product.title | escape -}}
                            </a>

                            <div
                              class="price__on-drawer priceWrapper{{ forloop.index }}{% if settings.hide_unit_price_in_cart %} price__on-drawer--hidden{% endif %}"
                              data-regular-price="{{ 'products.product.price.regular_price' | t }}"
                              data-sale-price="{{ 'products.product.price.sale_price' | t }}"
                            >
                              {%- if item.original_price != item.final_price -%}
                                <div class="cart-item__discounted-prices">
                                  <span class="visually-hidden">
                                    {{ 'products.product.price.regular_price' | t }}
                                  </span>
                                  <s class="cart-item__old-price product-option">
                                    {{- item.original_price | money -}}
                                  </s>
                                  <span class="visually-hidden">
                                    {{ 'products.product.price.sale_price' | t }}
                                  </span>
                                  <strong class="cart-item__final-price product-option">
                                    {{ item.final_price | money }}
                                  </strong>
                                </div>
                              {%- else -%}
                                <div class="product-option">
                                  {{ item.original_price | money }}
                                </div>
                              {%- endif -%}
                            </div>

                            {%- if item.product.has_only_default_variant == false
                              or item.properties.size != 0
                              or item.selling_plan_allocation != null
                            -%}
                              <dl>
                                {%- if item.product.has_only_default_variant == false -%}
                                  {%- for option in item.options_with_values -%}
                                    <div class="product-option">
                                      <dt>{{ option.name }}:</dt>
                                      <dd>
                                        {{ option.value -}}
                                        {%- unless forloop.last %}, {% endunless %}
                                      </dd>
                                    </div>
                                  {%- endfor -%}
                                {%- endif -%}

                                {%- for property in item.properties -%}
                                  {%- assign property_first_char = property.first | slice: 0 -%}
                                  {%- if property.last != blank and property_first_char != '_' -%}
                                    <div class="product-option product-option__property">
                                      <dt>{{ property.first }}:</dt>
                                      <dd>
                                        {%- if property.last contains '/uploads/' -%}
                                          <a
                                            href="{{ property.last }}"
                                            class="link"
                                            target="_blank"
                                            aria-describedby="a11y-new-window-message"
                                          >
                                            <img
                                              src="{{ property.last }}"
                                              alt="Image Preview"
                                              width="50"
                                              height="50"
                                              style="width: 50px; height: 50px; object-fit: cover;"
                                            >
                                          </a>
                                        {%- else -%}
                                          {{ property.last }}
                                        {%- endif -%}
                                      </dd>
                                    </div>
                                  {%- endif -%}
                                {%- endfor -%}
                              </dl>

                              <p class="product-option">{{ item.selling_plan_allocation.selling_plan.name }}</p>
                            {%- endif -%}

                            <ul
                              class="discounts list-unstyled"
                              role="list"
                              aria-label="{{ 'customer.order.discount' | t }}"
                            >
                              {%- for discount in item.discounts -%}
                                <li class="discounts__discount">
                                  {%- render 'icon-discount' -%}
                                  {{ discount.title }}
                                </li>
                              {%- endfor -%}
                            </ul>
                          </td>

                          <td class="cart-item__totals right" role="cell" headers="CartDrawer-ColumnTotal">
                            <div class="loading-overlay hidden">
                              <div class="loading-overlay__spinner">
                                <svg
                                  aria-hidden="true"
                                  focusable="false"
                                  class="spinner"
                                  viewBox="0 0 66 66"
                                  xmlns="http://www.w3.org/2000/svg"
                                >
                                  <circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
                                </svg>
                              </div>
                            </div>

                            <div class="cart-item__price-wrapper linePriceWrapper{{ forloop.index }}">
                              {%- if item.original_line_price != item.final_line_price -%}
                                <div class="cart-item__discounted-prices">
                                  <span class="visually-hidden">
                                    {{ 'products.product.price.regular_price' | t }}
                                  </span>
                                  <s class="cart-item__old-price product-option">
                                    {{- item.original_price | money -}}
                                  </s>
                                  <span class="visually-hidden">
                                    {{ 'products.product.price.sale_price' | t }}
                                  </span>
                                  <strong class="cart-item__final-price product-option">
                                    {{ item.final_price | money }}
                                  </strong>
                                </div>
                              {%- else -%}
                                <span class="product-option">
                                  {{ item.original_line_price | money }}
                                </span>
                              {%- endif -%}

                              {%- if item.variant.available and item.unit_price_measurement -%}
                                <div class="unit-price caption">
                                  <span class="visually-hidden">{{ 'products.product.price.unit_price' | t }}</span>
                                  {{ item.variant.unit_price | money }}
                                  <span aria-hidden="true">/</span>
                                  <span class="visually-hidden"
                                    >&nbsp;{{ 'accessibility.unit_price_separator' | t }}&nbsp;</span
                                  >
                                  {%- if item.variant.unit_price_measurement.reference_value != 1 -%}
                                    {{- item.variant.unit_price_measurement.reference_value -}}
                                  {%- endif -%}
                                  {{ item.variant.unit_price_measurement.reference_unit }}
                                </div>
                              {%- endif -%}
                            </div>
                          </td>

                          <td class="cart-item__quantity" role="cell" headers="CartDrawer-ColumnQuantity">
                            <div class="cart-item__quantity-wrapper">
                              <quantity-input
                                class="
                                  product__quantity product__quantity-hover--{{ section.settings.hover_effect }}
                                  product__quantity--{{ section.settings.secondary_background_border }}
                                  {%- if section.settings.remove_spacing %} product__quantity--super-glue {% endif -%}
                                  {%- if section.settings.secondary_background_buttons %}
                                    product__quantity--buttons-secondary
                                    {% unless section.settings.secondary_background_input %} alone{% else %} both_background{% endunless %}
                                  {% else %}
                                    {% unless section.settings.secondary_background_input %} no_background {% endunless %}
                                  {% endif -%}
                                "
                              >
                                <button class="quantity__button no-js-hidden" name="minus" type="button">
                                  <span class="visually-hidden">
                                    {{-
                                      'products.product.quantity.decrease'
                                      | t: product: item.product.title
                                      | escape
                                    -}}
                                  </span>
                                  {% render 'icon-minus' %}
                                </button>
                                <input
                                  class="quantity__input"
                                  type="number"
                                  data-quantity-variant-id="{{ item.variant.id }}"
                                  name="updates[]"
                                  value="{{ item.quantity }}"
                                  {% # theme-check-disable %}
                                  data-cart-quantity="{{ cart | item_count_for_variant: item.variant.id }}"
                                  min="{{ item.variant.quantity_rule.min }}"
                                  {% if item.variant.quantity_rule.max != null %}
                                    max="{{ item.variant.quantity_rule.max }}"
                                  {% endif %}
                                  step="{{ item.variant.quantity_rule.increment }}"
                                  {% # theme-check-enable %}
                                  aria-label="{{ 'products.product.quantity.input_label' | t: product: item.product.title | escape }}"
                                  id="Drawer-quantity-{{ item.index | plus: 1 }}"
                                  data-index="{{ item.index | plus: 1 }}"
                                >
                                <button class="quantity__button no-js-hidden" name="plus" type="button">
                                  <span class="visually-hidden">
                                    {{-
                                      'products.product.quantity.increase'
                                      | t: product: item.product.title
                                      | escape
                                    -}}
                                  </span>
                                  {% render 'icon-plus' %}
                                </button>
                              </quantity-input>

                              <cart-remove-button
                                id="CartDrawer-Remove-{{ item.index | plus: 1 }}"
                                data-index="{{ item.index | plus: 1 }}"
                              >
                                {% liquid
                                  if item.product_id == section.settings.cart_protection_product.id
                                    assign protection_index = forloop.index
                                  endif
                                %}
                                <button
                                  type="button"
                                  class="button button--tertiary"
                                  aria-label="{{ 'sections.cart.remove_title' | t: title: item.title }}"
                                >
                                  {% render 'icon-remove' %}
                                </button>
                              </cart-remove-button>
                            </div>

                            <div
                              id="CartDrawer-LineItemError-{{ item.index | plus: 1 }}"
                              class="cart-item__error"
                              role="alert"
                            >
                              <small class="cart-item__error-text"></small>
                              <svg
                                aria-hidden="true"
                                focusable="false"
                                class="icon icon-error"
                                viewBox="0 0 13 13"
                              >
                                <circle cx="6.5" cy="6.50049" r="5.5" stroke="white" stroke-width="2"/>
                                <circle cx="6.5" cy="6.5" r="5.5" fill="#EB001B" stroke="#EB001B" stroke-width="0.7"/>
                                <path d="M5.87413 3.52832L5.97439 7.57216H7.02713L7.12739 3.52832H5.87413ZM6.50076 9.66091C6.88091 9.66091 7.18169 9.37267 7.18169 9.00504C7.18169 8.63742 6.88091 8.34917 6.50076 8.34917C6.12061 8.34917 5.81982 8.63742 5.81982 9.00504C5.81982 9.37267 6.12061 9.66091 6.50076 9.66091Z" fill="white"/>
                                <path d="M5.87413 3.17832H5.51535L5.52424 3.537L5.6245 7.58083L5.63296 7.92216H5.97439H7.02713H7.36856L7.37702 7.58083L7.47728 3.537L7.48617 3.17832H7.12739H5.87413ZM6.50076 10.0109C7.06121 10.0109 7.5317 9.57872 7.5317 9.00504C7.5317 8.43137 7.06121 7.99918 6.50076 7.99918C5.94031 7.99918 5.46982 8.43137 5.46982 9.00504C5.46982 9.57872 5.94031 10.0109 6.50076 10.0109Z" fill="white" stroke="#EB001B" stroke-width="0.7">
                              </svg>
                            </div>
                          </td>
                        </tr>
                      {%- endfor -%}
                    </tbody>
                  </table>
                </div>
              {%- endif -%}
              <p id="CartDrawer-LiveRegionText" class="visually-hidden" role="status"></p>
              <p id="CartDrawer-LineItemStatus" class="visually-hidden" aria-hidden="true" role="status">
                {{ 'accessibility.loading' | t }}
              </p>
            </div>
            <div id="CartDrawer-CartErrors" role="alert"></div>
          </form>
        </cart-drawer-items>

        {%- if section.settings.cart_upsell_enable -%}
          <div class="drawer__upsell color-{{ section.settings.cart_module_upsell_palette }} drawer__upsell--{{ section.settings.cart_upsell_style }}">
            {%- if section.settings.cart_upsell_title -%}
              {%- if section.settings.cart_upsell_collection != blank or section.settings.cart_upsell_product != blank -%}
                <p class="drawer__upsell--title">{{ section.settings.cart_upsell_title }}</p>
              {%- endif -%}
            {%- endif -%}
            {%- if section.settings.cart_upsell_style == 'collection' and section.settings.cart_upsell_collection != blank -%}
              {%- assign collection = section.settings.cart_upsell_collection -%}
              <div id="drawer-upsell__swiper" class="swiper drawer__upsell--swiper">
                <div class="swiper-wrapper">
                  {%- for product in collection.products -%}
                    <div class="swiper-slide">
                      {%- render 'card-product-upsell-drawer',
                        section_id: section.id,
                        card_product: product,
                        card_style: section.settings.product_card_style,
                        button_text: section.settings.cart_upsell_button_text,
                        button_style: section.settings.cart_upsell_button_style
                      -%}
                    </div>
                  {%- endfor -%}
                </div>
              </div>
            {%- elsif section.settings.cart_upsell_style == 'product' and section.settings.cart_upsell_product != blank -%}
              {%- assign card_product = section.settings.cart_upsell_product -%}
              <div class="drawer__upsell--swiper">
                <a href="{{ card_product.url }}" class="drawer__upsell--link--media">
                  <div class="drawer__upsell--image global-media-settings media media--image">
                    {% comment %}theme-check-disable ImgLazyLoading{% endcomment %}
                    <img
                      srcset="
                        {%- if card_product.featured_media.width >= 165 -%}{{ card_product.featured_media | image_url: width: 165 }} 165w,{%- endif -%}
                        {%- if card_product.featured_media.width >= 360 -%}{{ card_product.featured_media | image_url: width: 360 }} 360w,{%- endif -%}
                        {%- if card_product.featured_media.width >= 533 -%}{{ card_product.featured_media | image_url: width: 533 }} 533w,{%- endif -%}
                        {%- if card_product.featured_media.width >= 720 -%}{{ card_product.featured_media | image_url: width: 720 }} 720w,{%- endif -%}
                        {%- if card_product.featured_media.width >= 940 -%}{{ card_product.featured_media | image_url: width: 940 }} 940w,{%- endif -%}
                        {%- if card_product.featured_media.width >= 1066 -%}{{ card_product.featured_media | image_url: width: 1066 }} 1066w,{%- endif -%}
                        {{ card_product.featured_media | image_url }} {{ card_product.featured_media.width }}w
                      "
                      src="{{ card_product.featured_media | image_url: width: 533 }}"
                      sizes="(min-width: {{ settings.page_width }}px) {{ settings.page_width | minus: 130 | divided_by: 4 }}px, (min-width: 990px) calc((100vw - 130px) / 4), (min-width: 750px) calc((100vw - 120px) / 3), calc((100vw - 35px) / 2)"
                      alt="{{ card_product.featured_media.alt | escape }}"
                      class="motion-reduce"
                      {% unless lazy_load == false %}
                        loading="lazy"
                      {% endunless %}
                      width="75"
                      height="{{ 75 | divided_by: item.image.aspect_ratio | ceil }}"
                    >
                    {% comment %}theme-check-enable ImgLazyLoading{% endcomment %}
                  </div>
                </a>
                <div class="drawer__upsell--product-informations">
                  <h3 class="card__product-heading heading--2-lines">
                    {{ card_product.title }}
                  </h3>
                  {% render 'price',
                    product: card_product,
                    use_variant: true,
                    price_class: priceClass,
                    formatting: formatting,
                    price_color: section.settings.card_product_price_color
                  %}
                </div>
                <div class="card__product-cta">
                  {%- render 'script' with 'product-form', defer: true -%}
                  <product-form class="product-form">
                    <div class="product-form__error-message-wrapper" role="alert" hidden="">
                      {% render 'icon-error' %}
                      <span class="product-form__error-message"></span>
                    </div>
                    <form
                      method="post"
                      action="/cart/add"
                      id="product-form-{{ section.id }}"
                      accept-charset="UTF-8"
                      class="form card__product-form drawer__upsell--single"
                      enctype="multipart/form-data"
                      novalidate="novalidate"
                      data-type="add-to-cart-form"
                      data-editor-form-attribute=""
                    >
                      <input type="hidden" name="form_type" value="product">
                      <input type="hidden" name="utf8" value="âœ“">
                      {%- unless card_product.has_only_default_variant -%}
                        <div class="select">
                          <select class="select__select product-variant-id" name="id">
                            {%- for variant in card_product.variants -%}
                              {%- if variant.available -%}
                                <option value="{{ variant.id }}">{{ variant.title | escape -}}</option>
                              {%- endif -%}
                            {%- endfor -%}
                          </select>
                          {% render 'icon-caret' %}
                        </div>
                      {%- else -%}
                        <input
                          type="hidden"
                          name="id"
                          value="{{ card_product.variants[0].id }}"
                          class="product-variant-id"
                        >
                      {%- endunless -%}
                      <div class="product-form__buttons card__product-form-buttons">
                        <button
                          id="ProductSubmitButton-{{ section.id }}"
                          type="submit"
                          name="add"
                          class="product-form__submit button button__style--{{ section.settings.cart_upsell_button_style }}"
                        >
                          <span>
                            {{- section.settings.cart_upsell_button_text }}
                          </span>
                          <div class="loading-overlay__spinner hidden">
                            <svg
                              aria-hidden="true"
                              focusable="false"
                              class="spinner"
                              viewBox="0 0 66 66"
                              xmlns="http://www.w3.org/2000/svg"
                            >
                              <circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
                            </svg>
                          </div>
                        </button>
                      </div>
                    </form>
                  </product-form>
                </div>
              </div>
            {%- endif -%}
          </div>
        {%- endif -%}
      </div>

      <div class="drawer__footer">
        {%- if section.settings.cart_protection_product != blank -%}
          <div class="drawer__protection drawer__upsell color-{{ section.settings.cart_module_protection_palette }}">
            {%- render 'card-product-protection-drawer',
              section_id: section.id,
              card_product: section.settings.cart_protection_product,
              card_style: section.settings.product_card_style,
              active: protection_active,
              protection_index: protection_index
            -%}
          </div>
        {%- endif -%}
        {%- if settings.show_cart_note -%}
          <details id="Details-CartDrawer" class="drawer__module drawer__module--note">
            <summary>
              <span class="summary__title">
                {{ 'sections.cart.note' | t }}
                {% render 'icon-caret', behavior: settings.collapsible_icon %}
              </span>
            </summary>
            <cart-note class="cart__note field">
              <label class="visually-hidden" for="CartDrawer-Note">{{ 'sections.cart.note' | t }}</label>
              <textarea
                id="CartDrawer-Note"
                class="text-area text-area--resize-vertical field__input"
                name="note"
                placeholder="{{ 'sections.cart.note' | t }}"
              >{{ cart.note }}</textarea>
            </cart-note>
          </details>
        {%- endif -%}

        {%- if section.settings.cart_module_code -%}
          <div class="drawer__module text-{{ section.settings.cart_modules_alignment }} color-{{ section.settings.cart_module_code_palette }} cart__discount-code drawer__module--code">
            <input
              type="text"
              id="cartDrawerDiscountCode"
              placeholder="{{ section.settings.cart_module_code_placeholder }}"
            >
            <div
              class="button button__style--{{ section.settings.cart_module_code_button_style }} cartDiscountCodeButton"
              data-input="cartDrawerDiscountCode"
            >
              {{ section.settings.cart_module_code_button_text | escape }}
            </div>
          </div>
        {%- endif -%}

        <!-- Start blocks -->
        <!-- Subtotals -->

        <div class="cart-drawer__footer" {{ block.shopify_attributes }}>
          {%- if section.settings.cart_subtotal_text != blank -%}
            <div class="totals subtotal" role="status">
              <p class="totals__subtotal">{{ section.settings.cart_subtotal_text }}</p>
              <p class="totals__subtotal-value drawer__subtotal--amount">...</p>
            </div>
          {%- endif -%}
          {%- if section.settings.cart_savings_text != blank -%}
            <div class="totals savings" role="status">
              <p class="totals__subtotal">{{ section.settings.cart_savings_text }}</p>
              <p class="totals__subtotal-value drawer__savings--amount">...</p>
            </div>
          {%- endif -%}
          <div class="totals" role="status">
            <p class="totals__subtotal">{{ section.settings.cart_total_text | default: 'Total' }}</p>
            <p class="totals__subtotal-value drawer__total--amount">{{ cart.total_price | money }}</p>
          </div>

          {%- if cart.cart_level_discount_applications.size > 0 -%}
            <div>
              <ul class="discounts list-unstyled" role="list" aria-label="{{ 'customer.order.discount' | t }}">
                {%- for discount in cart.cart_level_discount_applications -%}
                  <li class="discounts__discount discounts__discount--end">
                    {%- render 'icon-discount' -%}
                    {{ discount.title }}
                    (-{{ discount.total_allocated_amount | money }})
                  </li>
                {%- endfor -%}
              </ul>
            </div>
          {%- endif -%}
        </div>

        <!-- CTAs -->

        <div class="cart__ctas" {{ block.shopify_attributes }}>

          <button
            type="submit"
            id="CartDrawer-Checkout"
            class="cart__checkout-button button button__style--{{ section.settings.cart_button_style }}"
            name="checkout"
            form="CartDrawer-Form"
            {% if cart == empty %}
              disabled
            {% endif %}
          >
            {{ section.settings.cart_button_text | default: 'Check out' }}
          </button>
        </div>

        {%- if section.settings.cart_footer_text != blank
          or section.settings.cart_footer_image
          or section.settings.cart_footer_payment_badges
        -%}
          <div class="tax-note caption-large rte text-{{ section.settings.cart_modules_alignment }}">
            {%- if section.settings.cart_footer_payment_badges -%}
              <div class="tax-note__payment-badges">
                {% for type in shop.enabled_payment_types -%}
                  {{ type | payment_type_svg_tag }}
                {% endfor %}
              </div>
            {%- endif -%}
            {%- if section.settings.cart_footer_text != blank -%}
              <p>{{ section.settings.cart_footer_text }}</p>
            {%- endif -%}
            {%- if section.settings.cart_footer_image -%}
              <img
                class="tax-note__image"
                src="{{ section.settings.cart_footer_image | image_url: width: 400 }}"
                alt="{{ section.settings.cart_footer_image.alt | escape }}"
                loading="lazy"
                width="200"
                height="{{ 200 | divided_by: section.settings.cart_footer_image.aspect_ratio | ceil }}"
              >
            {%- endif -%}
          </div>
        {%- endif -%}
      </div>
    </div>
  </div>
</cart-drawer>

{% javascript %}
  class CartDrawer extends HTMLElement {
    constructor() {
      super();

      this.addEventListener('keyup', (evt) => evt.code === 'Escape' && this.close());
      this.querySelector('#CartDrawer-Overlay').addEventListener('click', this.close.bind(this));
      this.setHeaderCartIconAccessibility();
    }

    setHeaderCartIconAccessibility() {
      const cartLink = document.querySelector('#cart-icon-bubble');
      cartLink.setAttribute('role', 'button');
      cartLink.setAttribute('aria-haspopup', 'dialog');
    }

    open() {
      this.classList.add('animate', 'active');

      this.addEventListener('transitionend', () => {
        this.querySelector('input[type="search"]')?.focus();
      }, { once: true });

      document.body.classList.add('overflow-hidden');
    }

    close() {
      this.classList.remove('active');
      document.body.classList.remove('overflow-hidden');
    }
  }

  customElements.define('cart-drawer', CartDrawer);

  class CartDrawerItems extends CartItems {
    getSectionsToRender() {
      return [
        {
          id: 'CartDrawer',
          section: 'cart-drawer',
          selector: '.drawer__contents'
        },
        {
          id: 'cart-icon-bubble',
          section: 'cart-icon-bubble',
          selector: '.shopify-section'
        }
      ];
    }
  }

  customElements.define('cart-drawer-items', CartDrawerItems);
{% endjavascript %}