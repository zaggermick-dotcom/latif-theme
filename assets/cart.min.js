class CartRemoveButton extends HTMLElement{constructor(){super(),this.addEventListener("click",(e=>{e.preventDefault();const t=undefined;(this.closest("cart-items")||this.closest("cart-drawer-items")).updateQuantity(this.dataset.index,0)}))}}customElements.define("cart-remove-button",CartRemoveButton);class CartItems extends HTMLElement{constructor(){super(),this.lineItemStatusElement=document.getElementById("shopping-cart-line-item-status")||document.getElementById("CartDrawer-LineItemStatus");const e=debounce((e=>{this.onChange(e)}),ON_CHANGE_DEBOUNCE_TIMER),t=document.querySelectorAll(".cartDiscountCodeButton");t&&t.forEach((e=>{e.addEventListener("click",(()=>{this.handlePromoCode(e)}))}));const r=document.querySelector(".button__drawer--protection");r&&r.classList.contains("active")&&r.addEventListener("click",(e=>{e.preventDefault(),this.updateQuantity(r.dataset.index,0)})),this.addEventListener("change",e.bind(this))}cartUpdateUnsubscriber=void 0;connectedCallback(){this.cartUpdateUnsubscriber=subscribe(PUB_SUB_EVENTS.cartUpdate,(e=>{"cart-items"!==e.source&&this.onCartUpdate()}))}disconnectedCallback(){this.cartUpdateUnsubscriber&&this.cartUpdateUnsubscriber()}onChange(e){this.updateQuantity(e.target.dataset.index,e.target.value,document.activeElement.getAttribute("name"))}onCartUpdate(){fetch(`${routes.cart_url}?section_id=main-cart-items`).then((e=>e.text())).then((e=>{const t=undefined,r=(new DOMParser).parseFromString(e,"text/html").querySelector("cart-items");this.innerHTML=r.innerHTML})).catch((e=>{console.error(e)}))}getSectionsToRender(){return[{id:"main-cart-items",section:document.getElementById("main-cart-items").dataset.id,selector:".js-contents"},{id:"cart-icon-bubble",section:"cart-icon-bubble",selector:".shopify-section"},{id:"cart-live-region-text",section:"cart-live-region-text",selector:".shopify-section"}]}updateQuantity(e,t,r){this.enableLoading(e);const n=JSON.stringify({line:e,quantity:t,sections:this.getSectionsToRender().map((e=>e.section)),sections_url:window.location.pathname});fetch(`${routes.cart_change_url}`,{...fetchConfig(),body:n}).then((e=>e.text())).then((t=>{const n=JSON.parse(t),o=document.getElementById(`Quantity-${e}`)||document.getElementById(`Drawer-quantity-${e}`),a=document.querySelectorAll(".cart-item");if(n.errors)return o.value=o.getAttribute("value"),void this.updateLiveRegions(e,n.errors);this.classList.toggle("is-empty",0===n.item_count);const s=document.querySelector("cart-drawer");s&&s.classList.toggle("is-empty",0===n.item_count),this.getSectionsToRender().forEach((e=>{const t=undefined;(document.getElementById(e.id).querySelector(e.selector)||document.getElementById(e.id)).innerHTML=this.getSectionInnerHTML(n.sections[e.section],e.selector)}));const c=n.items[e-1]?n.items[e-1].quantity:void 0;let i="";if(a.length===n.items.length&&c!==parseInt(o.value)&&(i=void 0===c?window.cartStrings.error:window.cartStrings.quantityError.replace("[quantity]",c)),this.updateLiveRegions(e,i),document.querySelector(".drawer__module--timer")){const e=document.querySelector(".drawer__module--timer-time"),t=document.querySelector(".drawer__module--timer");let r;localStorage.getItem("storyThemeDrawerTimer")?r=localStorage.getItem("storyThemeDrawerTimer"):(r=60*t.dataset.duration,localStorage.setItem("storyThemeDrawerTimer",r));const n=()=>{const t=Math.floor(r/60),n=r%60;if(e.textContent=`${t}:${n.toString().padStart(2,"0")}`,r>0)localStorage.setItem("storyThemeDrawerTimer",r--);else{const e=new XMLHttpRequest;e.open("POST","/cart/clear.js",!0),e.setRequestHeader("Content-Type","application/json"),e.onreadystatechange=function(){4===e.readyState&&200===e.status&&(localStorage.removeItem("storyThemeDrawerTimer"),window.location.reload())},e.send()}};n(),setInterval((()=>{n()}),1e3)}const d=document.querySelectorAll(".drawer__module--free_shipping");if(d&&d.forEach((e=>{const t=e.querySelector(".free-shipping__left-amount"),r=e.querySelector(".free-shipping__success"),o=e.querySelector(".free-shipping__amount"),a=e.querySelector(".free-shipping__drag"),s=n.total_price/100,c=e.dataset.target,i=new Intl.NumberFormat(document.body.dataset.shopLocale,{style:"currency",currency:document.body.dataset.shopCurrency}).format(c-s);c-s>0?(o.textContent=i,t.classList.remove("hidden"),r.classList.add("hidden"),a.style.width=100*s/c+"%"):(r.classList.remove("hidden"),t.classList.add("hidden"),a.style.width="100%")})),document.querySelector("#drawer-trust__swiper")){const e=new Swiper("#drawer-trust__swiper",{autoplay:{delay:1e3},loop:!0,navigation:{nextEl:".button-next-drawer-trust__swiper",prevEl:".button-prev-drawer-trust__swiper"}})}if(document.querySelector("#drawer-upsell__swiper")){const e=new Swiper("#drawer-upsell__swiper",{slidesPerView:1.3,spaceBetween:15,autoHeight:!0})}function l(){fetch("/cart.js").then((function(e){return e.json()})).then((function(e){let t=0,r=0,n=1;e.items.forEach((function(e){const o=e.variant_id;let a=0;const s=new XMLHttpRequest;s.open("GET","/products/"+e.handle+".js",!1),s.setRequestHeader("Content-Type","application/json"),s.onreadystatechange=function(){if(4===s.readyState&&200===s.status){const e=undefined;JSON.parse(s.responseText).variants.forEach((function(e){if(e.id==o&&0!==e.compare_at_price)return a=e.compare_at_price,!1}))}},s.send();const c=e.original_line_price/e.quantity;let i="";const d=document.querySelector(`.priceWrapper${n}`),l=document.querySelector(`.linePriceWrapper${n}`);n++;const u=new Intl.NumberFormat(document.body.dataset.shopLocale,{style:"currency",currency:document.body.dataset.shopCurrency}).format(a/100),m=new Intl.NumberFormat(document.body.dataset.shopLocale,{style:"currency",currency:document.body.dataset.shopCurrency}).format(c/100),y=new Intl.NumberFormat(document.body.dataset.shopLocale,{style:"currency",currency:document.body.dataset.shopCurrency}).format(a*e.quantity/100),p=new Intl.NumberFormat(document.body.dataset.shopLocale,{style:"currency",currency:document.body.dataset.shopCurrency}).format(c*e.quantity/100),h=`\n                  <div class="cart-item__discounted-prices">\n                    <span class="visually-hidden">${d.dataset.salePrice}</span>\n                    <s class="cart-item__old-price product-option">${u}</s>\n                    <span class="visually-hidden">${d.dataset.regularPrice}</span>\n                    <strong class="cart-item__final-price product-option">${m}</strong>\n                  </div>\n                `,_=`<span class="product-option">${m}</span>`,g=`\n                  <div class="cart-item__discounted-prices">\n                    <span class="visually-hidden">${d.dataset.salePrice}</span>\n                    <s class="cart-item__old-price product-option">${y}</s>\n                    <span class="visually-hidden">${d.dataset.regularPrice}</span>\n                    <strong class="cart-item__final-price product-option">${p}</strong>\n                  </div>\n                `,f=`<span class="product-option">${p}</span>`;null==a||a<1?(t+=c+e.line_level_total_discount,r+=e.line_level_total_discount,a=0,e.original_price<=e.final_price&&(d.innerHTML=_,l.innerHTML=f)):a>c?(i=e.quantity*a,t+=i+e.line_level_total_discount,r+=i-e.original_line_price+e.line_level_total_discount,e.original_price<=e.final_price&&(d.innerHTML=h,l.innerHTML=g)):(t+=c+e.line_level_total_discount,e.original_price<=e.final_price&&(d.innerHTML=_,l.innerHTML=f))}));const o=new Intl.NumberFormat(document.body.dataset.shopLocale,{style:"currency",currency:document.body.dataset.shopCurrency}).format((e.total_price+r)/100),a=new Intl.NumberFormat(document.body.dataset.shopLocale,{style:"currency",currency:document.body.dataset.shopCurrency}).format(r/100),s=new Intl.NumberFormat(document.body.dataset.shopLocale,{style:"currency",currency:document.body.dataset.shopCurrency}).format(e.total_price/100),c=document.querySelector(".drawer__subtotal--amount"),i=document.querySelector(".drawer__savings--amount"),d=document.querySelector(".drawer__total--amount");c&&(r>0?(c.textContent=o,document.querySelector(".totals.subtotal").style.display="flex"):(document.querySelector(".totals.subtotal").style.display="none",document.querySelector(".totals.subtotal + *").style.marginTop="0")),i&&(r>0?(i.textContent="-"+a,document.querySelector(".totals.savings").style.display="flex"):(document.querySelector(".totals.savings").style.display="none",document.querySelector(".totals.savings + *").style.marginTop="0")),d&&(d.textContent=s)}))}l();const u=document.getElementById(`CartItem-${e}`)||document.getElementById(`CartDrawer-Item-${e}`);u&&u.querySelector(`[name="${r}"]`)?s?trapFocus(s,u.querySelector(`[name="${r}"]`)):u.querySelector(`[name="${r}"]`).focus():0===n.item_count&&s?trapFocus(s.querySelector(".drawer__inner-empty"),s.querySelector("a")):document.querySelector(".cart-item")&&s&&trapFocus(s,document.querySelector(".cart-item__name")),publish(PUB_SUB_EVENTS.cartUpdate,{source:"cart-items"})})).catch((e=>{console.error(e),this.querySelectorAll(".loading-overlay").forEach((e=>e.classList.add("hidden")));const t=undefined;(document.getElementById("cart-errors")||document.getElementById("CartDrawer-CartErrors")).textContent=window.cartStrings.error})).finally((()=>{this.disableLoading(e)}))}updateLiveRegions(e,t){const r=document.getElementById(`Line-item-error-${e}`)||document.getElementById(`CartDrawer-LineItemError-${e}`);r&&(r.querySelector(".cart-item__error-text").innerHTML=t),this.lineItemStatusElement.setAttribute("aria-hidden",!0);const n=document.getElementById("cart-live-region-text")||document.getElementById("CartDrawer-LiveRegionText");n.setAttribute("aria-hidden",!1),setTimeout((()=>{n.setAttribute("aria-hidden",!0)}),1e3)}getSectionInnerHTML(e,t){return(new DOMParser).parseFromString(e,"text/html").querySelector(t).innerHTML}enableLoading(e){const t=undefined;(document.getElementById("main-cart-items")||document.getElementById("CartDrawer-CartItems")).classList.add("cart__items--disabled");const r=undefined,n=undefined;[...this.querySelectorAll(`#CartItem-${e} .loading-overlay`),...this.querySelectorAll(`#CartDrawer-Item-${e} .loading-overlay`)].forEach((e=>e.classList.remove("hidden"))),document.activeElement.blur(),this.lineItemStatusElement.setAttribute("aria-hidden",!1)}handlePromoCode(e){const t=undefined,r=`/checkout?discount=${document.getElementById(e.dataset.input).value}`;window.location.href=r}disableLoading(e){const t=undefined;(document.getElementById("main-cart-items")||document.getElementById("CartDrawer-CartItems")).classList.remove("cart__items--disabled");const r=this.querySelectorAll(`#CartItem-${e} .loading-overlay`),n=this.querySelectorAll(`#CartDrawer-Item-${e} .loading-overlay`);r.forEach((e=>e.classList.add("hidden"))),n.forEach((e=>e.classList.add("hidden")))}}customElements.define("cart-items",CartItems),customElements.get("cart-note")||customElements.define("cart-note",class e extends HTMLElement{constructor(){super(),this.addEventListener("change",debounce((e=>{const t=JSON.stringify({note:e.target.value});fetch(`${routes.cart_update_url}`,{...fetchConfig(),body:t})}),ON_CHANGE_DEBOUNCE_TIMER))}});