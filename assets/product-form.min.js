customElements.get("product-form")||customElements.define("product-form",class t extends HTMLElement{constructor(){super(),this.form=this.querySelector("form"),this.form.querySelector("[name=id]")&&(this.form.querySelector("[name=id]").disabled=!1),this.form.addEventListener("submit",this.onSubmitHandler.bind(this)),this.cart=document.querySelector("cart-notification")||document.querySelector("cart-drawer"),this.submitButton=this.querySelector('[type="submit"]'),document.querySelector("cart-drawer")&&this.submitButton.setAttribute("aria-haspopup","dialog")}onSubmitHandler(t){if(t.preventDefault(),"true"===this.submitButton.getAttribute("aria-disabled"))return;const e=this.dataset.sectionId,r=document.querySelectorAll(`.custom__variant-required-${e} input`);let s=!0;if(r.forEach((t=>{t.value?t.classList.remove("field--error"):(s=!1,t.classList.add("field--error"))})),!s)return this.handleErrorMessage(window.productForm.error),void this.submitButton.classList.remove("loading");let i=!1;if(this.submitButton.classList.contains("button__drawer--protection")&&(i=!0),i&&this.submitButton.classList.contains("active"))return;this.handleErrorMessage(),this.submitButton.setAttribute("aria-disabled",!0),this.submitButton.classList.add("loading"),i||this.querySelector(".loading-overlay__spinner").classList.remove("hidden");const o=fetchConfig("javascript");o.headers["X-Requested-With"]="XMLHttpRequest",delete o.headers["Content-Type"];const a=window.productATCUpsells;let n="";this.querySelector(".product-variant-id")&&(n=this.querySelector(".product-variant-id").value);const d=document.querySelector(`input[name="quantity"][form="${this.form.getAttribute("id")}"]`);let u="1";u=d?d.value:"1";const c=new FormData(this.form);this.cart&&(a&&a.length>0&&a.forEach((t=>{"equals"===t.quantityBehavior?t.trigger.includes(n)&&t.quantity===u&&(c.append("items[][id]",t.idToAdd),c.append("items[][quantity]",t.quantityToAdd)):t.trigger.includes(n)&&t.quantity<=u&&(c.append("items[][id]",t.idToAdd),c.append("items[][quantity]",t.quantityToAdd))})),c.append("sections",this.cart.getSectionsToRender().map((t=>t.id))),c.append("sections_url",window.location.pathname),this.cart.setActiveElement(document.activeElement)),o.body=c,fetch(`${routes.cart_add_url}`,o).then((t=>t.json())).then((t=>{if(t.status){this.handleErrorMessage(t.description);const e=this.submitButton.querySelector(".sold-out-message");if(!e)return;return this.submitButton.setAttribute("aria-disabled",!0),this.submitButton.querySelector("span").classList.add("hidden"),e.classList.remove("hidden"),void(this.error=!0)}if(!this.cart)return void(window.location=window.routes.cart_url);this.error=!1;const e=this.closest("quick-add-modal");e?(document.body.addEventListener("modalClosed",(()=>{setTimeout((()=>{this.cart.renderContents(t)}))}),{once:!0}),e.hide(!0)):this.cart.renderContents(t)})).catch((t=>{console.error(t)})).finally((()=>{this.submitButton.classList.remove("loading"),this.cart&&this.cart.classList.contains("is-empty")&&this.cart.classList.remove("is-empty"),this.error||(this.submitButton.removeAttribute("aria-disabled"),i&&this.submitButton.classList.add("active")),i||this.querySelector(".loading-overlay__spinner").classList.add("hidden")}))}handleErrorMessage(t=!1){this.errorMessageWrapper=this.errorMessageWrapper||this.querySelector(".product-form__error-message-wrapper"),this.errorMessageWrapper&&(this.errorMessage=this.errorMessage||this.errorMessageWrapper.querySelector(".product-form__error-message"),this.errorMessageWrapper.toggleAttribute("hidden",!t),t&&(this.errorMessage.textContent=t))}});