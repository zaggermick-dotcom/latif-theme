class CartDrawer extends HTMLElement{constructor(){super(),this.addEventListener("keyup",(e=>"Escape"===e.code&&this.close())),this.querySelector("#CartDrawer-Overlay").addEventListener("click",this.close.bind(this)),this.setHeaderCartIconAccessibility();const e=document.querySelectorAll(".cartDiscountCodeButton");e&&e.forEach((e=>{e.addEventListener("click",(()=>{this.handlePromoCode(e)}))}))}handlePromoCode(e){const t=undefined,r=`/checkout?discount=${document.getElementById(e.dataset.input).value}`;window.location.href=r}setHeaderCartIconAccessibility(){const e=document.querySelector("#cart-icon-bubble");e&&(e.setAttribute("role","button"),e.setAttribute("aria-haspopup","dialog"),e.addEventListener("click",(t=>{t.preventDefault(),this.open(e)})),e.addEventListener("keydown",(t=>{"SPACE"===t.code.toUpperCase()&&(t.preventDefault(),this.open(e))})))}open(e){e&&this.setActiveElement(e);const t=this.querySelector('[id^="Details-"] summary');function r(){fetch("/cart.js").then((function(e){return e.json()})).then((function(e){let t=0,r=0,n=1;e.items.forEach((function(o){const s=o.variant_id;let a=0;const c=new XMLHttpRequest;c.open("GET","/products/"+o.handle+".js",!1),c.setRequestHeader("Content-Type","application/json"),c.onreadystatechange=function(){if(4===c.readyState&&200===c.status){const e=undefined;JSON.parse(c.responseText).variants.forEach((function(e){if(e.id==s&&0!==e.compare_at_price)return a=e.compare_at_price,!1}))}},c.send();const i=o.original_line_price/o.quantity,l=e.total_discount;let d="";const u=document.querySelector(`.priceWrapper${n}`),m=document.querySelector(`.linePriceWrapper${n}`);n++;const p=new Intl.NumberFormat(document.body.dataset.shopLocale,{style:"currency",currency:document.body.dataset.shopCurrency}).format(a/100),y=new Intl.NumberFormat(document.body.dataset.shopLocale,{style:"currency",currency:document.body.dataset.shopCurrency}).format(i/100),h=new Intl.NumberFormat(document.body.dataset.shopLocale,{style:"currency",currency:document.body.dataset.shopCurrency}).format(a*o.quantity/100),_=new Intl.NumberFormat(document.body.dataset.shopLocale,{style:"currency",currency:document.body.dataset.shopCurrency}).format(i*o.quantity/100),w=`\n              <div class="cart-item__discounted-prices">\n                <span class="visually-hidden">${u.dataset.salePrice}</span>\n                <s class="cart-item__old-price product-option">${p}</s>\n                <span class="visually-hidden">${u.dataset.regularPrice}</span>\n                <strong class="cart-item__final-price product-option">${y}</strong>\n              </div>\n            `,S=`<div class="product-option">${y}</div>`,b=`\n              <div class="cart-item__discounted-prices">\n                <span class="visually-hidden">${u.dataset.salePrice}</span>\n                <s class="cart-item__old-price product-option">${h}</s>\n                <span class="visually-hidden">${u.dataset.regularPrice}</span>\n                <strong class="cart-item__final-price product-option">${_}</strong>\n              </div>\n            `,f=`<span class="product-option">${_}</span>`;null==a||a<1?(t+=i+o.line_level_total_discount,r+=o.line_level_total_discount,a=0,o.original_price<=o.final_price&&(u.innerHTML=S,m.innerHTML=f)):a>i?(d=o.quantity*a,t+=d+o.line_level_total_discount,r+=d-o.original_line_price+o.line_level_total_discount,o.original_price<=o.final_price&&(u.innerHTML=w,m.innerHTML=b)):(t+=i+o.line_level_total_discount,o.original_price<=o.final_price&&(u.innerHTML=S,m.innerHTML=f))}));const o=new Intl.NumberFormat(document.body.dataset.shopLocale,{style:"currency",currency:document.body.dataset.shopCurrency}).format((e.total_price+r)/100),s=new Intl.NumberFormat(document.body.dataset.shopLocale,{style:"currency",currency:document.body.dataset.shopCurrency}).format(r/100),a=new Intl.NumberFormat(document.body.dataset.shopLocale,{style:"currency",currency:document.body.dataset.shopCurrency}).format(e.total_price/100),c=document.querySelector(".drawer__subtotal--amount"),i=document.querySelector(".drawer__savings--amount"),l=document.querySelector(".drawer__total--amount");c&&(r>0?(c.textContent=o,document.querySelector(".totals.subtotal").style.display="flex"):(document.querySelector(".totals.subtotal").style.display="none",document.querySelector(".totals.subtotal + *").style.marginTop="0")),i&&(r>0?(i.textContent="-"+s,document.querySelector(".totals.savings").style.display="flex"):(document.querySelector(".totals.savings").style.display="none",document.querySelector(".totals.savings + *").style.marginTop="0")),l&&(l.textContent=a)}))}t&&!t.hasAttribute("role")&&this.setSummaryAccessibility(t),this.classList.add("animate","active"),this.launchTimer(),this.launchTrustSlider(),this.launchUpsellSlider(),fetch("/cart.js").then((e=>e.json())).then((e=>{0===e.item_count&&(this.hideAllModules(),localStorage.getItem("storyThemeDrawerTimer")&&localStorage.removeItem("storyThemeDrawerTimer"));const t=document.querySelectorAll(".drawer__module--free_shipping");t&&t.forEach((t=>{const r=t.querySelector(".free-shipping__left-amount"),n=t.querySelector(".free-shipping__success"),o=t.querySelector(".free-shipping__amount"),s=t.querySelector(".free-shipping__drag"),a=e.total_price/100,c=t.dataset.target,i=new Intl.NumberFormat(document.body.dataset.shopLocale,{style:"currency",currency:document.body.dataset.shopCurrency}).format(c-a);c-a>0?(o.textContent=i,r.classList.remove("hidden"),n.classList.add("hidden"),s.style.width=100*a/c+"%"):(n.classList.remove("hidden"),r.classList.add("hidden"),s.style.width="100%")}))})),r(),this.addEventListener("transitionend",(()=>{const e=this.classList.contains("is-empty")?this.querySelector(".drawer__inner-empty"):document.getElementById("CartDrawer"),t=this.querySelector(".drawer__inner")||this.querySelector(".drawer__close");trapFocus(e,t)}),{once:!0}),document.body.classList.add("overflow-hidden"),document.documentElement.classList.add("overflow-hidden")}hideAllModules(){document.querySelectorAll(".drawer__module").forEach((e=>e.style.display="none"))}launchTrustSlider(){if(document.querySelector("#drawer-trust__swiper")){const e=new Swiper("#drawer-trust__swiper",{autoplay:{delay:1e3},loop:!0,navigation:{nextEl:".button-next-drawer-trust__swiper",prevEl:".button-prev-drawer-trust__swiper"}})}}launchUpsellSlider(){if(document.querySelector("#drawer-upsell__swiper")){const e=new Swiper("#drawer-upsell__swiper",{slidesPerView:1.2,spaceBetween:10,autoHeight:!0})}}launchTimer(){if(document.querySelector(".drawer__module--timer")){const e=document.querySelector(".drawer__module--timer-time"),t=document.querySelector(".drawer__module--timer");let r;localStorage.getItem("storyThemeDrawerTimer")?r=localStorage.getItem("storyThemeDrawerTimer"):(r=60*t.dataset.duration,localStorage.setItem("storyThemeDrawerTimer",r));const n=()=>{const t=Math.floor(r/60),n=r%60;if(e.textContent=`${t}:${n.toString().padStart(2,"0")}`,r>0)localStorage.setItem("storyThemeDrawerTimer",r--);else{const e=new XMLHttpRequest;e.open("POST","/cart/clear.js",!0),e.setRequestHeader("Content-Type","application/json"),e.onreadystatechange=function(){4===e.readyState&&200===e.status&&(localStorage.removeItem("storyThemeDrawerTimer"),window.location.reload())},e.send()}};n(),setInterval((()=>{n()}),1e3)}}close(){this.classList.remove("active"),removeTrapFocus(this.activeElement),document.body.classList.remove("overflow-hidden"),document.documentElement.classList.remove("overflow-hidden")}setSummaryAccessibility(e){e.setAttribute("role","button"),e.setAttribute("aria-expanded","false"),e.nextElementSibling.getAttribute("id")&&e.setAttribute("aria-controls",e.nextElementSibling.id),e.addEventListener("click",(e=>{e.currentTarget.setAttribute("aria-expanded",!e.currentTarget.closest("details").hasAttribute("open"))})),e.parentElement.addEventListener("keyup",onKeyUpEscape)}renderContents(e){this.querySelector(".drawer__inner").classList.contains("is-empty")&&this.querySelector(".drawer__inner").classList.remove("is-empty"),this.productId=e.id,this.getSectionsToRender().forEach((t=>{const r=t.selector?document.querySelector(t.selector):document.getElementById(t.id);r&&(r.innerHTML=this.getSectionInnerHTML(e.sections[t.id],t.selector))})),setTimeout((()=>{this.querySelector("#CartDrawer-Overlay").addEventListener("click",this.close.bind(this)),this.open()}))}getSectionInnerHTML(e,t=".shopify-section"){return(new DOMParser).parseFromString(e,"text/html").querySelector(t).innerHTML}getSectionsToRender(){return[{id:"cart-drawer",selector:"#CartDrawer"},{id:"cart-icon-bubble"}]}getSectionDOM(e,t=".shopify-section"){return(new DOMParser).parseFromString(e,"text/html").querySelector(t)}setActiveElement(e){this.activeElement=e}}customElements.define("cart-drawer",CartDrawer);class CartDrawerItems extends CartItems{getSectionsToRender(){return[{id:"CartDrawer",section:"cart-drawer",selector:".drawer__inner"},{id:"cart-icon-bubble",section:"cart-icon-bubble",selector:".shopify-section"}]}}customElements.define("cart-drawer-items",CartDrawerItems);