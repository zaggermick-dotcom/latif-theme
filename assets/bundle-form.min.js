const getFormattedAmount=e=>new Intl.NumberFormat(document.body.dataset.shopLocale,{style:"currency",currency:document.body.dataset.shopCurrency,minimumFractionDigits:0,maximumFractionDigits:2}).format(e/100);customElements.get("bundle-form")||customElements.define("bundle-form",class e extends HTMLElement{constructor(){super(),this.form=this.querySelector("form"),this.form.addEventListener("submit",this.onSubmitHandler.bind(this)),this.cart=document.querySelector("cart-notification")||document.querySelector("cart-drawer"),this.submitButton=this.querySelector('[type="submit"]'),document.querySelector("cart-drawer")&&this.submitButton.setAttribute("aria-haspopup","dialog"),this.querySelectorAll(".select__select").forEach((e=>{e.addEventListener("change",(t=>this.changeVariant(e,t)))})),this.querySelectorAll(".bundle__meta--checked input").forEach((e=>{e.addEventListener("change",(()=>this.changeChecked(e)))}))}updatePrice(e,t,r){e.dataset.price=t,e.dataset.compareAtPrice=r,e.querySelector(".price--compare del")&&(e.querySelector(".price--compare del").textContent=getFormattedAmount(r)),e.querySelector(".price--regular").textContent=getFormattedAmount(t),this.updateTotalPrice()}updateTotalPrice(){let e=0,t=0;const r=this.querySelectorAll(".bundle__product.checked").forEach((r=>{const s=+r.dataset.compareAtPrice>=+r.dataset.price?+r.dataset.compareAtPrice:+r.dataset.price;e+=s,t+=+r.dataset.price})),s=e>t;this.querySelector(".bundle__compare-at-price del")&&(this.querySelector(".bundle__compare-at-price del").style.display="inline-block",s?this.querySelector(".bundle__compare-at-price del").textContent=getFormattedAmount(e):this.querySelector(".bundle__compare-at-price del").style.display="none"),this.querySelector(".bundle__price--regular").textContent=getFormattedAmount(t)}onSubmitHandler(e){if(e.preventDefault(),"true"===this.submitButton.getAttribute("aria-disabled"))return;let t=!1;if(this.submitButton.classList.contains("button__drawer--protection")&&(t=!0),t&&this.submitButton.classList.contains("active"))return;this.handleErrorMessage(),this.submitButton.setAttribute("aria-disabled",!0),this.submitButton.classList.add("loading"),t||this.querySelector(".loading-overlay__spinner").classList.remove("hidden");const r=fetchConfig("javascript");r.headers["X-Requested-With"]="XMLHttpRequest",delete r.headers["Content-Type"];const s=new FormData;this.querySelectorAll(".bundle__product.checked").forEach((e=>{s.append("items[][id]",e.id),s.append("items[][quantity]",1)})),this.cart&&(s.append("sections",this.cart.getSectionsToRender().map((e=>e.id))),s.append("sections_url",window.location.pathname),this.cart.setActiveElement(document.activeElement)),r.body=s,fetch(`${routes.cart_add_url}`,r).then((e=>e.json())).then((e=>{if(e.status){this.handleErrorMessage(e.description);const t=this.submitButton.querySelector(".sold-out-message");if(!t)return;return this.submitButton.setAttribute("aria-disabled",!0),this.submitButton.querySelector("span").classList.add("hidden"),t.classList.remove("hidden"),void(this.error=!0)}this.cart?(this.error=!1,this.cart.renderContents(e)):window.location=window.routes.cart_url})).catch((e=>{console.error(e)})).finally((()=>{this.submitButton.classList.remove("loading"),this.cart&&this.cart.classList.contains("is-empty")&&this.cart.classList.remove("is-empty"),this.error||(this.submitButton.removeAttribute("aria-disabled"),t&&this.submitButton.classList.add("active")),t||this.querySelector(".loading-overlay__spinner").classList.add("hidden")}))}handleErrorMessage(e=!1){this.errorMessageWrapper=this.errorMessageWrapper||this.querySelector(".product-form__error-message-wrapper"),this.errorMessageWrapper&&(this.errorMessage=this.errorMessage||this.errorMessageWrapper.querySelector(".product-form__error-message"),this.errorMessageWrapper.toggleAttribute("hidden",!e),e&&(this.errorMessage.textContent=e))}changeVariant(e,t){const r=t.target,s=r.options[r.selectedIndex],i=this.querySelector(`.bundle__product--${e.dataset.productId}`);i.id=e.value,this.updatePrice(i,s.dataset.price,s.dataset.compareAtPrice)}changeChecked(e){const t=undefined;this.querySelector(`.bundle__product--${e.dataset.productId}`).classList.toggle("checked"),this.updateTotalPrice()}});